<!-- START CHAT ICON BUTTON -->

<!-- FAB Button -->
<button
  mat-fab
  class="chat-button"
  color="primary"
  aria-label="Chat"
  matBadge="{{ badgeNewMessages }}"
  matBadgePosition="before"
  matBadgeColor="primary"
  [matBadgeHidden]="badgeNewMessages === 0"
  (click)="showChatService = !showChatService"
>
  <mat-icon>chat</mat-icon>
</button>
<!-- END CHAT ICON BUTTON -->

<mat-card class="chat-service-container" *ngIf="showChatService">
  <mat-card-header class="card-header">
    <mat-card-title class="att-class-title" i18n>Asistencias</mat-card-title>
  </mat-card-header>
  <mat-divider></mat-divider>

  <!-- Attendances List -->
  <ng-container *ngFor="let chat of chats; let i = index">
    <!-- List Item -->
    <div
      class="list-item"
      [ngClass]="
        !chatSeleccionado || chatSeleccionado.idAsistencia !== chat.idAsistencia
          ? 'attendance-normal'
          : 'attendance-selected'
      "
      (click)="viewChat(chat)"
    >
      <mat-icon class="account-icon">account_circle</mat-icon>
      <p
        class="list-item-title"
        matBadge="{{ countNewChats(chat.idAsistencia) }}"
        matBadgeColor="primary"
        [matBadgeHidden]="countNewChats(chat.idAsistencia) === 0"
      >
        {{ chat.idServicio }}
      </p>
    </div>
    <mat-divider></mat-divider>
  </ng-container>
</mat-card>

<ng-container *ngIf="chatSeleccionado && showChatService">
  <mat-card class="chat-service-selected">
    <mat-icon class="close-dialog" (click)="closeChat()">close</mat-icon>
    <p class="service_title">
      {{ chatSeleccionado.idServicio }}
    </p>
    <p class="attendance_title" i18n>
      Asistencia: {{ chatSeleccionado.idAsistencia }}
    </p>

    <div class="chats-container">
      <div
        class="container"
        *ngFor="let dato of chatSeleccionado.dataChat; let i = index"
      >
        <mat-icon>account_circle</mat-icon>
        <ng-container *ngIf="dato.creadoPor == null">
          <p class="chat-user" i18n>tu</p>
        </ng-container>
        <ng-container *ngIf="dato.creadoPor != null">
          <p class="chat-user">{{ dato.creadoPor }}</p>
        </ng-container>
        <p class="chat-message">{{ dato.dato }}</p>
        <span class="time-right">{{ dato.fecha }}</span>
      </div>
    </div>

    <mat-form-field class="form-input-message" appearance="fill">
      <mat-label class="input-message-title" i18n>Mensaje</mat-label>
      <input
        matInput
        id="username"
        name="username"
        #message
        maxlength="50"
        i18n-placeholder
        placeholder="Inserte mensaje"
        #username
        class="input-message"
      />
    </mat-form-field>

    <button
      (click)="sendChat(username.value, chatSeleccionado.idAsistencia)"
      mat-fab
      color="primary"
      i18n-aria-label
      class="send-btn"
    >
      <mat-icon class="icon-chat">send</mat-icon>
    </button>

    <button
      class="close"
      (click)="cancelAttendance(chatSeleccionado.idAsistencia)"
      mat-raised-button
      i18n-aria-label
      title="Cancelar asistencia"
    >
      <span i18n>Cancelar asistencia</span>
    </button>
  </mat-card>
</ng-container>
